#!/bin/sh

set -e

if [ -n "${DEBUG}" ]; then
  set -x
fi

set -u

payload=$(cat)

url=$(printf '%s\n' "$payload" | "$(dirname "$0")"/lib/variables.sh url)
source_arguments=$(printf '%s\n' "$payload" | "$(dirname "$0")"/lib/variables.sh source.arguments)
params_arguments=$(printf '%s\n' "$payload" | "$(dirname "$0")"/lib/variables.sh params.arguments)

"$(dirname "$0")"/lib/curl.sh "$url" "$source_arguments $params_arguments"
"$(dirname "$0")"/lib/parse-times.sh

"$(dirname "$0")"/lib/print-metadata.sh
